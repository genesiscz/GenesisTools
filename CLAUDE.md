# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Common Development Commands

### Running Tools

```bash
# List all available tools interactively
tools

# Run a specific tool
tools <tool-name> [args]

# View a tool's README documentation
tools <tool-name> --readme

# Examples:
tools git-last-commits-diff . --commits 3 --clipboard
tools collect-files-for-ai ./my-repo -c 5
tools files-to-prompt src/ --cxml > prompt.xml
tools watch "src/**/*.ts" -v
tools npm-package-diff react 18.0.0 18.2.0
tools ask --readme  # View ask tool documentation
```

### Installation & Setup

```bash
# Initial setup (requires Bun)
bun install && ./install.sh
source ~/.zshrc  # or ~/.bashrc

# The install script adds GenesisTools to PATH by modifying shell config files
```

## Architecture Overview

GenesisTools is a TypeScript-based CLI toolkit that runs on Bun. The architecture follows a plugin pattern where each tool is self-contained:

### Core Structure

-   **Entry Point**: The `tools` executable is a TypeScript file with a shebang that:
  -   Without arguments: Shows an interactive tool selector using @inquirer/prompts
  -   With arguments: Executes the specified tool by running `bun run` on the appropriate file
-   **Tool Discovery**: Tools are discovered by checking `/src/` for:
  -   Directories containing `index.ts` or `index.tsx` (tool name = directory name)
  -   Standalone `.ts` or `.tsx` files (tool name = filename without extension)
-   **Execution Model**: Each tool runs in its own process via `bun run`, inheriting stdio for seamless interaction

### Key Components

-   **Logger** (`src/logger.ts`): Centralized logging using pino, outputs to `/logs/` directory organized by date
-   **MCP Integration**: Several tools implement Model Context Protocol servers for AI assistant integration
-   **No Build Step**: Bun executes TypeScript directly without compilation

### Utility Convention

When creating a new tool and writing helper functions, check if the utility is **general-purpose** (usable by other tools). If so, place it in `src/utils/` instead of inside the tool directory:

- `src/utils/format.ts` - Formatting: bytes, duration, tokens, numbers, lists
- `src/utils/table.ts` - Text table formatting
- `src/utils/string.ts` - String utilities (glob matching, ANSI stripping)
- `src/utils/storage/storage.ts` - Config & cache management
- `src/utils/async.ts` - Async helpers (concurrency, etc.)
- `src/utils/json-schema.ts` - JSON schema inference: `inferSchema()`, `formatSchema(value, "skeleton"|"typescript"|"schema")`

Tool-specific logic stays in the tool directory (e.g., `src/har-analyzer/core/`).

### Tool Patterns

Most tools follow these common patterns:

**CLI Argument Parsing**:

-   Use `commander` for parsing command-line arguments with subcommands and options
-   Define command structure with `.command()`, `.option()`, and `.action()`
-   Provide clear `--help` documentation with usage examples (auto-generated by commander)

**Interactive User Experience**:

-   Two prompt libraries available: `@inquirer/prompts` (legacy) and `@clack/prompts` (preferred for new tools)
-   See "Choosing a Prompt Library" below for when to use each
-   Common prompt types: `select`, `input`, `confirm`, `checkbox`/`multiselect`
-   Handle user cancellation gracefully
-   Provide sensible defaults and suggestions in prompts

**Output Handling**:

-   Support multiple output destinations: file, clipboard, stdout
-   Use `clipboardy` for clipboard operations
-   Use `chalk` for colored terminal output (but strip ANSI codes for non-TTY)
-   Respect `--silent` and `--verbose` flags

**Process Execution**:

-   Use `Bun.spawn()` for executing external commands
-   Handle stdout/stderr streams properly using `new Response(proc.stdout).text()`
-   Always check exit codes and provide meaningful error messages

**File Operations**:

-   Use Node.js `path` module for cross-platform path handling
-   Resolve relative paths to absolute using `resolve()`
-   Check file/directory existence before operations
-   Use Bun's native file APIs (`Bun.write()`) for better performance

## How to Write Tools

See `.claude/docs/tool-template.md` for complete templates (@inquirer + @clack/prompts), common patterns, and best practices.

## Important Notes

-   **Runtime**: This project requires Bun as it uses Bun-specific APIs (e.g., `Bun.spawn`)
-   **Global Access**: The `install.sh` script modifies shell config to add GenesisTools to PATH
-   **No Tests**: The project currently has no test suite
-   **TypeScript Config**: Strict mode enabled, ES modules, no emit (Bun runs TS directly)
-   **Logging**: Check `/logs/` directory for debug information if tools encounter errors

## Context7 Library IDs for Documentation Lookup

When researching Microsoft/Azure APIs, use these context7 library IDs:

| Library ID | Use For | Key Topics |
|------------|---------|------------|
| `/websites/learn_microsoft_en-us_rest_api_azure_devops` | Azure DevOps REST API | Work items, revisions, updates, comments, WIQL, reporting APIs |
| `/microsoftdocs/azure-docs-cli` | Azure CLI commands | `az boards`, `az devops`, `az pipelines`, `az repos`, `az rest` |
| `/microsoftdocs/azure-devops-docs` | Azure DevOps general docs | Process templates, boards config, permissions |

**Usage with context7 MCP:**
```bash
# 1. Resolve library ID
mcp__context7-mcp__resolve-library-id with libraryName="azure devops rest api"

# 2. Query docs (use the resolved ID)
mcp__context7-mcp__get-library-docs with context7CompatibleLibraryID="/websites/learn_microsoft_en-us_rest_api_azure_devops" topic="work item revisions"
```

**When to use context7 vs local docs:**
- **Context7**: For detailed API specs, parameters, response schemas, edge cases
- **Local docs** (`src/azure-devops/docs/`): Quick reference for `az` CLI commands with examples

### Local Azure DevOps CLI Documentation

See `src/azure-devops/docs/` for comprehensive CLI reference (~15K tokens total):
- `az-boards-work-item.md` - Work item CRUD
- `az-boards-iteration.md` - Sprint/iteration management
- `az-repos-pr.md` - Pull request workflows
- `az-rest.md` - Raw REST API calls
- `work-item-history-api-reference.md` - **Revisions, updates, comments APIs** (detailed)

### Azure DevOps API Quick Reference

**Batch endpoints (reduce API calls):**
- `POST /wit/workitemsbatch` - Get up to 200 work items in one call (current state only)
- `GET /wit/reporting/workitemrevisions` - **Batch history** for multiple work items (use for sync)

**Per-item endpoints:**
- `GET /wit/workitems/{id}?$expand=all` - Single work item with all fields/relations
- `GET /wit/workitems/{id}/updates` - Field change deltas (no batch available)
- `GET /wit/workitems/{id}/revisions` - Full snapshots per revision
- `GET /wit/workitems/{id}/comments` - Comments (no cross-item batch)
